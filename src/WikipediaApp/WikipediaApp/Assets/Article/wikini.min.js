function registerEventListeners(){registerContextmenuEvents(),registerScrollEvents()}const sectionMargin=50;let timer,sections=[];function registerScrollEvents(){window.addEventListener("resize",(function(e){_refresh()})),window.addEventListener("scroll",(function(e){_updateScrollPosition(this.scrollX,this.scrollY)})),_updateSections(!0),_updateScrollPosition(window.scrollX,window.scrollY)}function scrollToSection(e){const t=document.getElementById(e);if(null!=t){let e=t.parentElement;for(;null!=e&&"SECTION"!==e.tagName;)e=e.parentElement;null==e||e.classList.contains("open-block")||(e.previousSibling.click(),_refresh()),t.scrollIntoView()}}function _refresh(){_updateSections(!1),_updateScrollPosition(window.scrollX,window.scrollY)}function _updateSections(e){sections=[],document.querySelectorAll(".mw-headline").forEach((function(t){e&&t.parentElement.classList.contains("section-heading")&&t.parentElement.addEventListener("click",(function(e){clearTimeout(timer),timer=setTimeout(_refresh,150)}));const s=t.parentElement.offsetTop;s>0&&sections.push({id:t.id,top:s,element:t})}))}function _updateScrollPosition(e,t){const s=document.documentElement,n=s.scrollWidth-s.clientWidth,r=s.scrollHeight-s.clientHeight,o=sections.length-[...sections].reverse().findIndex(e=>t>=e.top-50)-1,i=o>=0&&o<sections.length?sections[o].id.replace(/'/g,"\\'"):"";window.external.notify(`{ 'Message': 'Scroll', 'X': ${e}, 'Y': ${t}, 'Width': ${n}, 'Height': ${r}, 'Text': '${i}' }`)}function registerContextmenuEvents(){var e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)e[t].addEventListener("contextmenu",_handleContextmenu)}function _handleContextmenu(e){const t=e.target.getAttribute("href");if(!t||t.startsWith("#"))return;const s=e.target.getBoundingClientRect(),n=s.left,r=s.top,o=s.right-n,i=s.bottom-r,a=e.target.href,c=e.target.title.replace(/'/g,"\\'");window.external.notify(`{ 'Message': 'Contextmenu', 'X': ${n}, 'Y': ${r}, 'Width': ${o}, 'Height': ${i}, 'Url': '${a}', 'Text': '${c}' }`)}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Mark=t()}(this,(function(){"use strict";class e{constructor(e,t=!0,s=[],n=5e3){this.ctx=e,this.iframes=t,this.exclude=s,this.iframesTimeout=n}static matches(e,t){const s="string"==typeof t?[t]:t,n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;if(n){let t=!1;return s.every(s=>!n.call(e,s)||(t=!0,!1)),t}return!1}getContexts(){let e,t=[];return(e=void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[]).forEach(e=>{const s=t.filter(t=>t.contains(e)).length>0;-1!==t.indexOf(e)||s||t.push(e)}),t}getIframeContents(e,t,s=(()=>{})){let n;try{const t=e.contentWindow;if(n=t.document,!t||!n)throw new Error("iframe inaccessible")}catch(e){s()}n&&t(n)}isIframeBlank(e){const t="about:blank",s=e.getAttribute("src").trim();return e.contentWindow.location.href===t&&s!==t&&s}observeIframeLoad(e,t,s){let n=!1,r=null;const o=()=>{if(!n){n=!0,clearTimeout(r);try{this.isIframeBlank(e)||(e.removeEventListener("load",o),this.getIframeContents(e,t,s))}catch(e){s()}}};e.addEventListener("load",o),r=setTimeout(o,this.iframesTimeout)}onIframeReady(e,t,s){try{"complete"===e.contentWindow.document.readyState?this.isIframeBlank(e)?this.observeIframeLoad(e,t,s):this.getIframeContents(e,t,s):this.observeIframeLoad(e,t,s)}catch(e){s()}}waitForIframes(e,t){let s=0;this.forEachIframe(e,()=>!0,e=>{s++,this.waitForIframes(e.querySelector("html"),()=>{--s||t()})},e=>{e||t()})}forEachIframe(t,s,n,r=(()=>{})){let o=t.querySelectorAll("iframe"),i=o.length,a=0;o=Array.prototype.slice.call(o);const c=()=>{--i<=0&&r(a)};i||c(),o.forEach(t=>{e.matches(t,this.exclude)?c():this.onIframeReady(t,e=>{s(t)&&(a++,n(e)),c()},c)})}createIterator(e,t,s){return document.createNodeIterator(e,t,s,!1)}createInstanceOnIframe(t){return new e(t.querySelector("html"),this.iframes)}compareNodeIframe(e,t,s){if(e.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_PRECEDING){if(null===t)return!0;if(t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)return!0}return!1}getIteratorNode(e){const t=e.previousNode();let s;return{prevNode:t,node:s=(null===t||e.nextNode())&&e.nextNode()}}checkIframeFilter(e,t,s,n){let r=!1,o=!1;return n.forEach((e,t)=>{e.val===s&&(r=t,o=e.handled)}),this.compareNodeIframe(e,t,s)?(!1!==r||o?!1===r||o||(n[r].handled=!0):n.push({val:s,handled:!0}),!0):(!1===r&&n.push({val:s,handled:!1}),!1)}handleOpenIframes(e,t,s,n){e.forEach(e=>{e.handled||this.getIframeContents(e.val,e=>{this.createInstanceOnIframe(e).forEachNode(t,s,n)})})}iterateThroughNodes(e,t,s,n,r){const o=this.createIterator(t,e,n);let i,a,c=[],l=[],h=()=>(({prevNode:a,node:i}=this.getIteratorNode(o)),i);for(;h();)this.iframes&&this.forEachIframe(t,e=>this.checkIframeFilter(i,a,e,c),t=>{this.createInstanceOnIframe(t).forEachNode(e,e=>l.push(e),n)}),l.push(i);l.forEach(e=>{s(e)}),this.iframes&&this.handleOpenIframes(c,e,s,n),r()}forEachNode(e,t,s,n=(()=>{})){const r=this.getContexts();let o=r.length;o||n(),r.forEach(r=>{const i=()=>{this.iterateThroughNodes(e,r,t,s,()=>{--o<=0&&n()})};this.iframes?this.waitForIframes(r,i):i()})}}class t{constructor(e){this.opt=Object.assign({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},e)}create(e){return"disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.createJoinersRegExp(e)),"disabled"!==this.opt.wildcards&&(e=this.createWildcardsRegExp(e)),e=this.createAccuracyRegExp(e),new RegExp(e,"gm"+(this.opt.caseSensitive?"":"i"))}sortByLength(e){return e.sort((e,t)=>e.length===t.length?e>t?1:-1:t.length-e.length)}escapeStr(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}createSynonymsRegExp(e){const t=this.opt.synonyms,s=this.opt.caseSensitive?"":"i",n=this.opt.ignoreJoiners||this.opt.ignorePunctuation.length?"\0":"";for(let r in t)if(t.hasOwnProperty(r)){let o=Array.isArray(t[r])?t[r]:[t[r]];o.unshift(r),(o=this.sortByLength(o).map(e=>("disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),this.escapeStr(e))).filter(e=>""!==e)).length>1&&(e=e.replace(new RegExp(`(${o.map(e=>this.escapeStr(e)).join("|")})`,"gm"+s),n+`(${o.map(e=>this.processSynonyms(e)).join("|")})`+n))}return e}processSynonyms(e){return(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),e}setupWildcardsRegExp(e){return(e=e.replace(/(?:\\)*\?/g,e=>"\\"===e.charAt(0)?"?":"")).replace(/(?:\\)*\*/g,e=>"\\"===e.charAt(0)?"*":"")}createWildcardsRegExp(e){let t="withSpaces"===this.opt.wildcards;return e.replace(/\u0001/g,t?"[\\S\\s]?":"\\S?").replace(/\u0002/g,t?"[\\S\\s]*?":"\\S*")}setupIgnoreJoinersRegExp(e){return e.replace(/[^(|)\\]/g,(e,t,s)=>{let n=s.charAt(t+1);return/[(|)\\]/.test(n)||""===n?e:e+"\0"})}createJoinersRegExp(e){let t=[];const s=this.opt.ignorePunctuation;return Array.isArray(s)&&s.length&&t.push(this.escapeStr(s.join(""))),this.opt.ignoreJoiners&&t.push("\\u00ad\\u200b\\u200c\\u200d"),t.length?e.split(/\u0000+/).join(`[${t.join("")}]*`):e}createDiacriticsRegExp(e){const t=this.opt.caseSensitive?"":"i",s=this.opt.caseSensitive?["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"]:["aàáảãạăằắẳẵặâầấẩẫậäåāąAÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćčCÇĆČ","dđďDĐĎ","eèéẻẽẹêềếểễệëěēęEÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïīIÌÍỈĨỊÎÏĪ","lłLŁ","nñňńNÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøōOÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rřRŘ","sšśșşSŠŚȘŞ","tťțţTŤȚŢ","uùúủũụưừứửữựûüůūUÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿYÝỲỶỸỴŸ","zžżźZŽŻŹ"];let n=[];return e.split("").forEach(r=>{s.every(s=>{if(-1!==s.indexOf(r)){if(n.indexOf(s)>-1)return!1;e=e.replace(new RegExp(`[${s}]`,"gm"+t),`[${s}]`),n.push(s)}return!0})}),e}createMergedBlanksRegExp(e){return e.replace(/[\s]+/gim,"[\\s]+")}createAccuracyRegExp(e){let t=this.opt.accuracy,s="string"==typeof t?t:t.value,n="string"==typeof t?[]:t.limiters,r="";switch(n.forEach(e=>{r+="|"+this.escapeStr(e)}),s){case"partially":default:return`()(${e})`;case"complementary":return`()([^${r="\\s"+(r||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~¡¿"))}]*${e}[^${r}]*)`;case"exactly":return`(^|\\s${r})(${e})(?=$|\\s${r})`}}}class s{constructor(e){this.ctx=e,this.ie=!1;const t=window.navigator.userAgent;(t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1)&&(this.ie=!0)}set opt(e){this._opt=Object.assign({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:()=>{},noMatch:()=>{},filter:()=>!0,done:()=>{},debug:!1,log:window.console},e)}get opt(){return this._opt}get iterator(){return new e(this.ctx,this.opt.iframes,this.opt.exclude,this.opt.iframesTimeout)}log(e,t="debug"){const s=this.opt.log;this.opt.debug&&"object"==typeof s&&"function"==typeof s[t]&&s[t]("mark.js: "+e)}getSeparatedKeywords(e){let t=[];return e.forEach(e=>{this.opt.separateWordSearch?e.split(" ").forEach(e=>{e.trim()&&-1===t.indexOf(e)&&t.push(e)}):e.trim()&&-1===t.indexOf(e)&&t.push(e)}),{keywords:t.sort((e,t)=>t.length-e.length),length:t.length}}isNumeric(e){return Number(parseFloat(e))==e}checkRanges(e){if(!Array.isArray(e)||"[object Object]"!==Object.prototype.toString.call(e[0]))return this.log("markRanges() will only accept an array of objects"),this.opt.noMatch(e),[];const t=[];let s=0;return e.sort((e,t)=>e.start-t.start).forEach(e=>{let{start:n,end:r,valid:o}=this.callNoMatchOnInvalidRanges(e,s);o&&(e.start=n,e.length=r-n,t.push(e),s=r)}),t}callNoMatchOnInvalidRanges(e,t){let s,n,r=!1;return e&&void 0!==e.start?(n=(s=parseInt(e.start,10))+parseInt(e.length,10),this.isNumeric(e.start)&&this.isNumeric(e.length)&&n-t>0&&n-s>0?r=!0:(this.log("Ignoring invalid or overlapping range: "+JSON.stringify(e)),this.opt.noMatch(e))):(this.log("Ignoring invalid range: "+JSON.stringify(e)),this.opt.noMatch(e)),{start:s,end:n,valid:r}}checkWhitespaceRanges(e,t,s){let n,r=!0,o=s.length,i=t-o,a=parseInt(e.start,10)-i;return(n=(a=a>o?o:a)+parseInt(e.length,10))>o&&(n=o,this.log("End range automatically set to the max value of "+o)),a<0||n-a<0||a>o||n>o?(r=!1,this.log("Invalid range: "+JSON.stringify(e)),this.opt.noMatch(e)):""===s.substring(a,n).replace(/\s+/g,"")&&(r=!1,this.log("Skipping whitespace only range: "+JSON.stringify(e)),this.opt.noMatch(e)),{start:a,end:n,valid:r}}getTextNodes(e){let t="",s=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,e=>{s.push({start:t.length,end:(t+=e.textContent).length,node:e})},e=>this.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT,()=>{e({value:t,nodes:s})})}matchesExclude(t){return e.matches(t,this.opt.exclude.concat(["script","style","title","head","html"]))}wrapRangeInTextNode(e,t,s){const n=this.opt.element?this.opt.element:"mark",r=e.splitText(t),o=r.splitText(s-t);let i=document.createElement(n);return i.setAttribute("data-markjs","true"),this.opt.className&&i.setAttribute("class",this.opt.className),i.textContent=r.textContent,r.parentNode.replaceChild(i,r),o}wrapRangeInMappedTextNode(e,t,s,n,r){e.nodes.every((o,i)=>{const a=e.nodes[i+1];if(void 0===a||a.start>t){if(!n(o.node))return!1;const a=t-o.start,c=(s>o.end?o.end:s)-o.start,l=e.value.substr(0,o.start),h=e.value.substr(c+o.start);if(o.node=this.wrapRangeInTextNode(o.node,a,c),e.value=l+h,e.nodes.forEach((t,s)=>{s>=i&&(e.nodes[s].start>0&&s!==i&&(e.nodes[s].start-=c),e.nodes[s].end-=c)}),s-=c,r(o.node.previousSibling,o.start),!(s>o.end))return!1;t=o.end}return!0})}wrapGroups(e,t,s,n){return n((e=this.wrapRangeInTextNode(e,t,t+s)).previousSibling),e}separateGroups(e,t,s,n,r){let o=t.length;for(let s=1;s<o;s++){let o=e.textContent.indexOf(t[s]);t[s]&&o>-1&&n(t[s],e)&&(e=this.wrapGroups(e,o,t[s].length,r))}return e}wrapMatches(e,t,s,n,r){const o=0===t?0:t+1;this.getTextNodes(t=>{t.nodes.forEach(t=>{let r;for(t=t.node;null!==(r=e.exec(t.textContent))&&""!==r[o];){if(this.opt.separateGroups)t=this.separateGroups(t,r,o,s,n);else{if(!s(r[o],t))continue;let e=r.index;if(0!==o)for(let t=1;t<o;t++)e+=r[t].length;t=this.wrapGroups(t,e,r[o].length,n)}e.lastIndex=0}}),r()})}wrapMatchesAcrossElements(e,t,s,n,r){const o=0===t?0:t+1;this.getTextNodes(t=>{let i;for(;null!==(i=e.exec(t.value))&&""!==i[o];){let r=i.index;if(0!==o)for(let e=1;e<o;e++)r+=i[e].length;const a=r+i[o].length;this.wrapRangeInMappedTextNode(t,r,a,e=>s(i[o],e),(t,s)=>{e.lastIndex=s,n(t)})}r()})}wrapRangeFromIndex(e,t,s,n){this.getTextNodes(r=>{const o=r.value.length;e.forEach((e,n)=>{let{start:i,end:a,valid:c}=this.checkWhitespaceRanges(e,o,r.value);c&&this.wrapRangeInMappedTextNode(r,i,a,s=>t(s,e,r.value.substring(i,a),n),t=>{s(t,e)})}),n()})}unwrapMatches(e){const t=e.parentNode;let s=document.createDocumentFragment();for(;e.firstChild;)s.appendChild(e.removeChild(e.firstChild));t.replaceChild(s,e),this.ie?this.normalizeTextNode(t):t.normalize()}normalizeTextNode(e){if(e){if(3===e.nodeType)for(;e.nextSibling&&3===e.nextSibling.nodeType;)e.nodeValue+=e.nextSibling.nodeValue,e.parentNode.removeChild(e.nextSibling);else this.normalizeTextNode(e.firstChild);this.normalizeTextNode(e.nextSibling)}}markRegExp(e,t){this.opt=t,this.log(`Searching with expression "${e}"`);let s=0,n="wrapMatches";this.opt.acrossElements&&(n="wrapMatchesAcrossElements"),this[n](e,this.opt.ignoreGroups,(e,t)=>this.opt.filter(t,e,s),e=>{s++,this.opt.each(e)},()=>{0===s&&this.opt.noMatch(e),this.opt.done(s)})}mark(e,s){this.opt=s;let n=0,r="wrapMatches";const{keywords:o,length:i}=this.getSeparatedKeywords("string"==typeof e?[e]:e),a=e=>{const s=new t(this.opt).create(e);let c=0;this.log(`Searching with expression "${s}"`),this[r](s,1,(t,s)=>this.opt.filter(s,e,n,c),e=>{c++,n++,this.opt.each(e)},()=>{0===c&&this.opt.noMatch(e),o[i-1]===e?this.opt.done(n):a(o[o.indexOf(e)+1])})};this.opt.acrossElements&&(r="wrapMatchesAcrossElements"),0===i?this.opt.done(n):a(o[0])}markRanges(e,t){this.opt=t;let s=0,n=this.checkRanges(e);n&&n.length?(this.log("Starting to mark with the following ranges: "+JSON.stringify(n)),this.wrapRangeFromIndex(n,(e,t,s,n)=>this.opt.filter(e,t,s,n),(e,t)=>{s++,this.opt.each(e,t)},()=>{this.opt.done(s)})):this.opt.done(s)}unmark(t){this.opt=t;let s=this.opt.element?this.opt.element:"*";s+="[data-markjs]",this.opt.className&&(s+="."+this.opt.className),this.log(`Removal selector "${s}"`),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,e=>{this.unwrapMatches(e)},t=>{const n=e.matches(t,s),r=this.matchesExclude(t);return!n||r?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},this.opt.done)}}return function(e){const t=new s(e);return this.mark=(e,s)=>(t.mark(e,s),this),this.markRegExp=(e,s)=>(t.markRegExp(e,s),this),this.markRanges=(e,s)=>(t.markRanges(e,s),this),this.unmark=e=>(t.unmark(e),this),this}}));let results=[],currentIndex=0,markInstance=null,content=null;function search(e){markInstance||(content=document.getElementById("content"),markInstance=new Mark(content)),markInstance.unmark({done:function(){markInstance.mark(e,{separateWordSearch:!1,acrossElements:!0,done:function(){results=content.getElementsByTagName("mark"),currentIndex=0,_jumpTo(),window.external.notify(`{ 'Message': 'SearchResults', 'Number': ${results.length.toString()} }`)}})}})}function searchForward(){results.length&&(++currentIndex>=results.length&&(currentIndex=0),_jumpTo())}function searchBackward(){results.length&&(--currentIndex<0&&(currentIndex=results.length-1),_jumpTo())}function _jumpTo(){if(results.length){for(let e=0;e<results.length;e++)results[e].classList.remove("current");const e=results.item(currentIndex);e&&(e.classList.add("current"),_scrollIntoView(e))}}function _scrollIntoView(e){const t=e.getBoundingClientRect();t.bottom+50>window.innerHeight&&window.scrollBy(0,t.bottom-window.innerHeight+50),t.top<0&&window.scrollBy(0,t.top-30)}